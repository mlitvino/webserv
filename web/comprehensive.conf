# Webserv Configuration File
# This is a comprehensive example showing all supported features

# First server - Main website
server {
	listen 8080;
	server_name localhost www.localhost;
	client_max_body_size 1048576;  # 1MB limit
	
	# Custom error pages
	error_page 404 /errors/404.html;
	error_page 500 /errors/500.html;
	error_page 403 /errors/403.html;
	
	# Root location - serves static files
	location / {
		root /web/www;
		index index.html index.htm;
		allow_methods GET HEAD;
		autoindex on;
	}
	
	# Upload area - allows file uploads
	location /upload {
		root /web/uploads;
		allow_methods GET POST DELETE;
		autoindex on;
	}
	
	# API endpoint with POST support
	location /api {
		root /web/api;
		index api.html;
		allow_methods GET POST PUT DELETE;
		autoindex off;
	}
	
	# CGI scripts location
	location /cgi-bin {
		root /web/cgi-bin;
		allow_methods GET POST;
		cgi_extension .py;
		cgi_path /usr/bin/python3;
		autoindex off;
	}
	
	# Redirect old paths
	location /old-site {
		return 301 https://newsite.com;
	}
}

# Second server - Development/Testing
server {
	listen 8081;
	server_name dev.localhost;
	client_max_body_size 2097152;  # 2MB limit for development
	
	error_page 404 /dev_errors/not_found.html;
	
	location / {
		root /web/dev;
		index dev.html;
		allow_methods GET POST DELETE PUT HEAD;
		autoindex on;
	}
	
	location /test {
		root /web/test;
		allow_methods GET POST;
		autoindex on;
	}
}

# Third server - File server
server {
	listen 8082;
	server_name files.localhost;
	client_max_body_size 10485760;  # 10MB limit for file uploads
	
	# File browser with directory listing
	location / {
		root /web/files;
		allow_methods GET HEAD;
		autoindex on;
	}
	
	# Upload endpoint
	location /upload {
		root /web/files/uploads;
		allow_methods POST;
		autoindex off;
	}
	
	# Download endpoint
	location /download {
		root /web/files/public;
		allow_methods GET;
		autoindex on;
	}
}
